<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Taxi Grand 1.0</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #F8FAFC;
            --text-main: #0F172A;
            --text-sec: #64748B;
            --accent: #F59E0B;
            --accent-glow: rgba(245, 158, 11, 0.3);
            --card-bg: #FFFFFF;
            --font: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Roboto", sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font);
            margin: 0; padding: 0; height: 100vh;
            display: flex; flex-direction: column;
            overflow: hidden; user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- STAGE (CITY & GAME) --- */
        .stage {
            flex: 1; position: relative;
            display: flex; flex-direction: column;
            justify-content: flex-end;
            overflow: hidden;
            background: linear-gradient(to bottom, #BFDBFE 0%, #EFF6FF 100%); /* Day Sky */
        }

        /* –ü–∞—Ä–∞–ª–ª–∞–∫—Å –≥–æ—Ä–æ–¥ */
        .city-layer {
            position: absolute; bottom: 0; left: 0; right: 0;
            background-repeat: repeat-x;
            background-position: bottom left;
            opacity: 0.7;
        }
        .city-back {
            height: 30%; background-size: 100px 100%; z-index: 1;
            background-image: linear-gradient(to top, #94A3B8 0%, #94A3B8 80%, transparent 80%);
        }
        .city-front {
            height: 15%; background-size: 60px 100%; z-index: 2;
            background-image: linear-gradient(to top, #64748B 0%, #64748B 90%, transparent 90%);
        }
        .road {
            position: absolute; bottom: 0; width: 100%; height: 80px;
            background: #334155; z-index: 3;
            border-top: 4px solid #FCD34D; /* Road line */
        }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä—ã */
        .game-hud {
            position: absolute; top: 0; left: 0; right: 0;
            padding: 20px; z-index: 20;
            display: flex; justify-content: space-between;
        }
        .hud-pill {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(8px);
            padding: 8px 14px; border-radius: 20px;
            font-weight: 700; font-size: 14px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            display: flex; align-items: center; gap: 6px;
        }

        /* –ú–∞—à–∏–Ω–∞ */
        .car-container {
            position: relative; z-index: 10; align-self: center;
            margin-bottom: 40px; transition: transform 0.1s;
        }
        .car-emoji {
            font-size: 120px; filter: drop-shadow(0 15px 15px rgba(0,0,0,0.3));
        }

        /* –ü—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å–∫–æ—Ä–æ—Å—Ç—å */
        .info-panel {
            position: absolute; top: 80px; width: 100%; text-align: center; z-index: 10;
        }
        .speed-val { font-size: 48px; font-weight: 900; color: var(--text-main); text-shadow: 0 2px 0 rgba(255,255,255,0.8); }
        .progress-track {
            width: 200px; height: 8px; background: rgba(255,255,255,0.6);
            margin: 0 auto; border-radius: 4px; overflow: hidden; margin-top: 5px;
        }
        .progress-fill { height: 100%; width: 0%; background: var(--accent); }

        /* –ö–ª–∏–µ–Ω—Ç */
        .client-tag {
            background: white; padding: 6px 12px; border-radius: 12px;
            position: absolute; top: -30px; left: 50%; transform: translateX(-50%);
            white-space: nowrap; font-weight: 700; font-size: 13px;
            opacity: 0; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* –ö–Ω–æ–ø–∫–∞ */
        .controls-area {
            background: white; padding: 20px; z-index: 30;
            border-radius: 24px 24px 0 0;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.05);
        }
        .btn-big {
            width: 100%; padding: 18px; border: none; border-radius: 16px;
            background: var(--text-main); color: white;
            font-size: 18px; font-weight: 800; letter-spacing: 0.5px;
            cursor: pointer; transition: 0.1s;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .btn-big:active { transform: scale(0.98); }
        .btn-big.fuel { background: var(--accent); color: black; }

        /* --- TABS (SHOP & LEADERBOARD) --- */
        .tab-layer {
            display: none; position: absolute; top: 0; left: 0; right: 0; bottom: 80px;
            background: var(--bg-color); z-index: 50; padding: 20px; overflow-y: auto;
        }
        .tab-layer.active { display: block; }
        
        .section-header { font-size: 26px; font-weight: 900; margin-bottom: 20px; color: var(--text-main); }
        
        .list-item {
            background: var(--card-bg); padding: 16px; border-radius: 16px; margin-bottom: 12px;
            display: flex; align-items: center; justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        .buy-btn {
            background: #F1F5F9; border: none; padding: 8px 16px;
            border-radius: 10px; font-weight: 700; color: var(--text-main);
        }
        .buy-btn.active { background: var(--text-main); color: white; }

        /* --- LEADERBOARD SPECIFIC --- */
        .rank-row {
            display: flex; align-items: center; gap: 12px;
            padding: 12px; border-radius: 12px; margin-bottom: 8px; background: white;
        }
        .rank-num { font-weight: 900; font-size: 16px; width: 30px; color: #94A3B8; }
        .rank-name { flex: 1; font-weight: 600; }
        .rank-score { font-weight: 700; color: var(--accent); }
        
        .rank-row.me { border: 2px solid var(--accent); background: #FFFBEB; }
        .rank-row.top1 .rank-num { color: #F59E0B; } /* Gold */
        .rank-row.top2 .rank-num { color: #94A3B8; } /* Silver */
        .rank-row.top3 .rank-num { color: #B45309; } /* Bronze */

        /* --- NAV BAR --- */
        .nav-bar {
            background: white; border-top: 1px solid #E2E8F0;
            padding: 8px 0; padding-bottom: env(safe-area-inset-bottom);
            display: flex; justify-content: space-around; z-index: 100;
        }
        .nav-btn {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            width: 60px; color: #94A3B8; font-size: 10px; font-weight: 600;
        }
        .nav-btn.active { color: var(--text-main); }
        .nav-btn svg { width: 24px; height: 24px; fill: currentColor; }

        /* Anim */
        .pop-txt {
            position: absolute; font-weight: 900; font-size: 24px; pointer-events: none;
            animation: fly 0.8s forwards; color: var(--text-main);
        }
        @keyframes fly { 100% { opacity:0; transform:translateY(-80px); } }

    </style>
</head>
<body>

    <!-- GAME HUD -->
    <div class="game-hud">
        <div class="hud-pill">üí∞ <span id="ui-money">0</span></div>
        <div class="hud-pill" style="color:var(--accent)">üèÜ <span id="ui-rank">#999</span></div>
        <div class="hud-pill">‚õΩ <span id="ui-fuel">10</span></div>
    </div>

    <!-- MAIN GAME STAGE -->
    <div id="tab-game" class="stage">
        <!-- Parallax Background -->
        <div class="city-layer city-back" id="bg-back"></div>
        <div class="city-layer city-front" id="bg-front"></div>
        <div class="road"><div style="position:absolute; top:40px; width:100%; height:4px; background:repeating-linear-gradient(90deg, #fff 0 30px, transparent 0 60px); opacity:0.3" id="bg-road"></div></div>

        <!-- Info -->
        <div class="info-panel">
            <div class="speed-val"><span id="ui-speed">0</span> <span style="font-size:20px;color:#64748B">km/h</span></div>
            <div class="progress-track"><div class="progress-fill" id="ui-prog"></div></div>
        </div>

        <!-- Car -->
        <div class="car-container" id="car-wrap" onclick="tap(event)">
            <div class="client-tag" id="ui-client">–ü–∞—Å—Å–∞–∂–∏—Ä</div>
            <div class="car-emoji" id="ui-car">üöñ</div>
        </div>

        <!-- Controls -->
        <div class="controls-area">
            <button id="btn-act" class="btn-big" onclick="action()">–í–ó–Ø–¢–¨ –ó–ê–ö–ê–ó</button>
        </div>
    </div>

    <!-- LEADERBOARD TAB -->
    <div id="tab-lead" class="tab-layer">
        <div class="section-header">–¢–∞–±–ª–∏—Ü–∞ –õ–∏–¥–µ—Ä–æ–≤</div>
        
        <div style="background:var(--text-main); color:white; padding:20px; border-radius:16px; margin-bottom:20px;">
            <div style="font-size:12px; opacity:0.7">–¢–í–û–Ø –õ–ò–ì–ê</div>
            <div style="font-size:24px; font-weight:800; color:var(--accent)" id="ui-league">–ë—Ä–æ–Ω–∑–æ–≤–∞—è</div>
            <div style="margin-top:10px; display:flex; justify-content:space-between; font-size:14px;">
                <span>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: <b id="ui-stats-orders">0</b></span>
                <span>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <b id="ui-stats-total">0</b></span>
            </div>
        </div>

        <div id="leaderboard-list">
            <!-- JS –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ -->
        </div>
    </div>

    <!-- SHOP TAB -->
    <div id="tab-shop" class="tab-layer">
        <div class="section-header">–ì–∞—Ä–∞–∂</div>
        <div id="shop-list"></div>
        
        <div class="section-header" style="margin-top:30px">–ù–∞–≤—ã–∫–∏</div>
        <div class="list-item">
            <div><b>–ë–æ–ª—å—à–æ–π –±–∞–∫</b><br><span style="font-size:12px;color:#64748B">+1 –∫ —Ç–æ–ø–ª–∏–≤—É</span></div>
            <button class="buy-btn" id="btn-upg-tank" onclick="upgrade('tank')">500üí∞</button>
        </div>
        <div class="list-item">
            <div><b>–¢—É—Ä–±–æ –∫–ª–∏–∫</b><br><span style="font-size:12px;color:#64748B">+10% –∫ —Ä–∞–∑–≥–æ–Ω—É</span></div>
            <button class="buy-btn" id="btn-upg-click" onclick="upgrade('click')">1000üí∞</button>
        </div>
    </div>

    <!-- NAV BAR -->
    <div class="nav-bar">
        <div class="nav-btn active" onclick="setTab('game', this)">
            <svg viewBox="0 0 24 24"><path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.85 7h10.29l1.08 3.11H5.77L6.85 7zM19 17H5v-5h14v5z"/></svg>
            –ò–≥—Ä–∞
        </div>
        <div class="nav-btn" onclick="setTab('lead', this)">
            <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/></svg>
            –¢–æ–ø
        </div>
        <div class="nav-btn" onclick="setTab('shop', this)">
            <svg viewBox="0 0 24 24"><path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/></svg>
            –ì–∞—Ä–∞–∂
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- CONFIG ---
        const SAVE_KEY = 'taxi_release_v1';
        const carsDB = [
            { id: 0, name: "Start", emoji: "üöô", price: 0, reward: 20, power: 1.0 },
            { id: 1, name: "Comfort", emoji: "üöñ", price: 1000, reward: 50, power: 1.3 },
            { id: 2, name: "Sport", emoji: "üèéÔ∏è", price: 5000, reward: 150, power: 1.8 },
            { id: 3, name: "Luxury", emoji: "üöÅ", price: 20000, reward: 400, power: 2.5 }
        ];
        const clients = ["–°—Ç—É–¥–µ–Ω—Ç", "–ë–∞–±—É–ª—è", "–¢—É—Ä–∏—Å—Ç", "–ë–∏–∑–Ω–µ—Å–º–µ–Ω", "–ö–æ—Ç"];

        // --- STATE ---
        let state = {
            money: 0, 
            xp: 0, 
            totalEarned: 0,
            orders: 0,
            fuel: 10,
            lastRefill: Date.now(),
            owned: [0], 
            selected: 0,
            upgrades: { tank: 0, click: 0 }
        };

        // --- MIGRATION (–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö) ---
        function attemptMigration() {
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏
                const oldv9 = localStorage.getItem('taxi_city_09');
                const oldv8 = localStorage.getItem('taxi_universal_save');
                
                let restored = null;
                if(oldv9) restored = JSON.parse(oldv9);
                else if(oldv8) restored = JSON.parse(oldv8);

                if(restored) {
                    // –ü–µ—Ä–µ–Ω–æ—Å–∏–º –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                    state.money = restored.money || 0;
                    state.xp = restored.xp || 0;
                    state.owned = restored.owned || [0];
                    state.selected = restored.selected || 0;
                    if(restored.upgrades) state.upgrades = restored.upgrades;
                    tg.showAlert("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ –ø—Ä–æ—à–ª–æ–π –≤–µ—Ä—Å–∏–∏!");
                }
            } catch(e) { console.error("Migrate err", e); }
        }

        // --- CORE ---
        function load() {
            const data = localStorage.getItem(SAVE_KEY);
            if(data) {
                state = { ...state, ...JSON.parse(data) };
            } else {
                attemptMigration(); // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ v1.0
            }
            // –†–µ–≥–µ–Ω —Ç–æ–ø–ª–∏–≤–∞
            let max = 10 + state.upgrades.tank;
            let passed = Math.floor((Date.now() - state.lastRefill)/60000);
            if(passed > 0 && state.fuel < max) {
                state.fuel = Math.min(max, state.fuel + passed);
                state.lastRefill = Date.now();
            }
            save();
        }
        function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }

        // --- LEADERBOARD LOGIC (Simulation) ---
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º "—Ñ–µ–π–∫–æ–≤—ã–π" —Ä–µ–π—Ç–∏–Ω–≥ –≤–æ–∫—Ä—É–≥ –∏–≥—Ä–æ–∫–∞, —á—Ç–æ–±—ã –±—ã–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ
        function getLeaderboard() {
            let myXP = state.xp;
            let list = [
                { name: "–í—ã (You)", xp: myXP, me: true },
                { name: "UberDriver", xp: myXP + 500 },
                { name: "LuckyGuy", xp: Math.max(0, myXP - 150) },
                { name: "ProRacer", xp: myXP + 1200 },
                { name: "Alex777", xp: Math.max(0, myXP - 400) },
                { name: "TaxiKing", xp: myXP + 5000 },
                { name: "Speedy", xp: Math.max(0, myXP - 50) },
                { name: "Ivan", xp: myXP + 250 }
            ];
            // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
            list.sort((a,b) => b.xp - a.xp);
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–Ω–∫
            let myRank = list.findIndex(x => x.me) + 1;
            // –î–æ–±–∞–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ (—á–µ–º –±–æ–ª—å—à–µ XP, —Ç–µ–º –≤—ã—à–µ "—Ä–µ–∞–ª—å–Ω–æ–µ" –º–µ—Å—Ç–æ)
            // –î–æ–ø—É—Å—Ç–∏–º, –≤—Å–µ–≥–æ 10000 –≤–æ–¥–∏—Ç–µ–ª–µ–π. 
            // 0 XP = 10000 –º–µ—Å—Ç–æ. 10000 XP = 1 –º–µ—Å—Ç–æ.
            let globalRank = Math.max(1, 10000 - Math.floor(myXP / 10));
            return { list, globalRank };
        }

        // --- GAMEPLAY ---
        let isRunning = false;
        let speed = 0, progress = 0, loop = null, bgOff = 0;
        let curClient = "";

        function action() {
            if(state.fuel <= 0) {
                if(state.money >= 10) { 
                    state.money -= 10; state.fuel++; 
                    save(); updateUI(); tg.HapticFeedback.notificationOccurred('success');
                } else tg.showAlert("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç 10 –º–æ–Ω–µ—Ç!");
                return;
            }

            state.fuel--;
            state.lastRefill = Date.now();
            isRunning = true;
            progress = 0;
            speed = 0;
            
            curClient = clients[Math.floor(Math.random()*clients.length)];
            document.getElementById('ui-client').innerText = curClient;
            document.getElementById('ui-client').style.opacity = 1;

            save(); updateUI();

            loop = setInterval(() => {
                speed *= 0.95; 
                if(speed < 0.1) speed = 0;
                progress += speed * 0.12;

                // Parallax
                bgOff -= speed * 2;
                document.getElementById('bg-front').style.backgroundPositionX = bgOff + "px";
                document.getElementById('bg-back').style.backgroundPositionX = (bgOff * 0.5) + "px";
                document.getElementById('bg-road').style.backgroundPositionX = (bgOff * 2) + "px";

                // UI
                document.getElementById('ui-speed').innerText = Math.floor(speed * 20);
                document.getElementById('ui-prog').style.width = Math.min(progress, 100) + '%';
                
                let bounce = (speed > 1) ? Math.sin(Date.now()/40)*3 : 0;
                document.getElementById('ui-car').style.transform = `translateY(${bounce}px)`;

                if(progress >= 100) finish();
            }, 50);
        }

        function tap(e) {
            if(!isRunning) return;
            let car = carsDB.find(c=>c.id===state.selected);
            let p = car.power * (1 + state.upgrades.click*0.1);
            
            if(speed > 5) p *= 0.6;
            speed += p;
            if(speed > 9) speed = 9;

            document.getElementById('car-wrap').style.transform = "scale(0.95)";
            setTimeout(()=>document.getElementById('car-wrap').style.transform = "scale(1)", 80);
            
            tg.HapticFeedback.impactOccurred('light');
            if(e) showPop(e.clientX, e.clientY);
        }

        function showPop(x,y) {
            let el = document.createElement('div');
            el.className = 'pop-txt'; el.innerText = "üí®";
            el.style.left=x+'px'; el.style.top=y+'px';
            document.body.appendChild(el);
            setTimeout(()=>el.remove(), 800);
        }

        function finish() {
            clearInterval(loop);
            isRunning = false;
            document.getElementById('ui-client').style.opacity = 0;
            document.getElementById('ui-prog').style.width = '0%';
            
            let car = carsDB.find(c=>c.id===state.selected);
            let earn = car.reward + Math.floor(Math.random()*20);
            
            state.money += earn;
            state.totalEarned += earn;
            state.orders++;
            state.xp += 25;

            tg.HapticFeedback.notificationOccurred('success');
            save(); updateUI();
        }

        // --- UPGRADES ---
        function upgrade(type) {
            let lvl = state.upgrades[type];
            let cost = (type === 'tank') ? 500*(lvl+1) : 1000*(lvl+1);
            if(state.money >= cost) {
                state.money -= cost;
                state.upgrades[type]++;
                save(); updateUI(); tg.HapticFeedback.notificationOccurred('success');
            } else tg.showAlert("–ú–∞–ª–æ –¥–µ–Ω–µ–≥!");
        }

        function buyCar(id) {
            let c = carsDB.find(x=>x.id===id);
            if(state.money >= c.price) {
                state.money -= c.price;
                state.owned.push(id);
                state.selected = id;
                save(); updateUI();
            }
        }
        function pickCar(id) { state.selected = id; save(); updateUI(); }

        // --- UI RENDER ---
        function updateUI() {
            document.getElementById('ui-money').innerText = state.money;
            document.getElementById('ui-fuel').innerText = state.fuel;
            
            let car = carsDB.find(c=>c.id===state.selected);
            document.getElementById('ui-car').innerText = car.emoji;

            // Render Shop
            let list = document.getElementById('shop-list');
            list.innerHTML = '';
            carsDB.forEach(c => {
                let isOwned = state.owned.includes(c.id);
                let btn = isOwned 
                    ? `<button class="buy-btn" onclick="pickCar(${c.id})">–í–∑—è—Ç—å</button>`
                    : `<button class="buy-btn" onclick="buyCar(${c.id})">${c.price}üí∞</button>`;
                if(state.selected === c.id) btn = `<button class="buy-btn active">–í—ã–±—Ä–∞–Ω–æ</button>`;
                
                list.innerHTML += `<div class="list-item">
                    <div style="font-size:24px;margin-right:10px">${c.emoji}</div>
                    <div style="flex:1"><b>${c.name}</b><br><span style="font-size:12px;color:#64748B">+${c.reward}üí∞</span></div>
                    ${btn}
                </div>`;
            });

            // Prices
            document.getElementById('btn-upg-tank').innerText = 500*(state.upgrades.tank+1) + "üí∞";
            document.getElementById('btn-upg-click').innerText = 1000*(state.upgrades.click+1) + "üí∞";

            // Leaderboard Data
            let leadData = getLeaderboard();
            document.getElementById('ui-rank').innerText = "#" + leadData.globalRank;
            
            // Stats
            document.getElementById('ui-stats-orders').innerText = state.orders;
            document.getElementById('ui-stats-total').innerText = state.totalEarned;
            
            let league = "–ë—Ä–æ–Ω–∑–æ–≤–∞—è";
            let color = "#B45309";
            if(state.xp > 1000) { league = "–°–µ—Ä–µ–±—Ä—è–Ω–∞—è"; color="#94A3B8"; }
            if(state.xp > 5000) { league = "–ó–æ–ª–æ—Ç–∞—è"; color="#F59E0B"; }
            if(state.xp > 20000) { league = "–ü–ª–∞—Ç–∏–Ω–æ–≤–∞—è"; color="#3B82F6"; }
            
            let lEl = document.getElementById('ui-league');
            lEl.innerText = league; lEl.style.color = color;

            // Render List
            let leadHTML = '';
            leadData.list.forEach((u, i) => {
                let cls = u.me ? "rank-row me" : "rank-row";
                if(i===0) cls += " top1";
                if(i===1) cls += " top2";
                if(i===2) cls += " top3";
                leadHTML += `<div class="${cls}">
                    <div class="rank-num">${i+1}</div>
                    <div class="rank-name">${u.name}</div>
                    <div class="rank-score">${u.xp} XP</div>
                </div>`;
            });
            document.getElementById('leaderboard-list').innerHTML = leadHTML;

            // Button Main
            let btn = document.getElementById('btn-act');
            if(!isRunning) {
                if(state.fuel > 0) {
                    btn.innerText = "–í–ó–Ø–¢–¨ –ó–ê–ö–ê–ó"; btn.className = "btn-big"; btn.disabled = false;
                } else {
                    btn.innerText = "–ö–£–ü–ò–¢–¨ –ë–ï–ù–ó–ò–ù (10üí∞)"; btn.className = "btn-big fuel"; btn.disabled = false;
                }
            } else {
                btn.innerText = "–í –ü–£–¢–ò..."; btn.disabled = true;
            }
        }

        window.setTab = (id, el) => {
            document.querySelectorAll('.tab-layer').forEach(x=>x.classList.remove('active'));
            if(id !== 'game') document.getElementById('tab-'+id).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(x=>x.classList.remove('active'));
            el.classList.add('active');
        };

        // Fuel Loop
        setInterval(() => {
            if(state.fuel < (10 + state.upgrades.tank)) {
                if(Date.now() - state.lastRefill > 60000) {
                    state.fuel++; state.lastRefill = Date.now(); save(); updateUI();
                }
            }
        }, 1000);

        load(); updateUI();

    </script>
</body>
</html>